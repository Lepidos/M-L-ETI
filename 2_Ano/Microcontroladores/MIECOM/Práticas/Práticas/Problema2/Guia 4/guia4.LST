A51 MACRO ASSEMBLER  GUIA4                                                                11/26/2013 21:53:25 PAGE     1


MACRO ASSEMBLER A51 V8.02b
OBJECT MODULE PLACED IN guia4.OBJ
ASSEMBLER INVOKED BY: C:\Keil\C51\BIN\A51.EXE guia4.a51 SET(SMALL) DEBUG EP

LOC  OBJ            LINE     SOURCE

                       1     ;#include <89C51Rx2.inc>
                       2     ;       INICIO DE PROGRAMA
                       3                     NAME MAIN
                       4     
                       5                     EXTRN   CODE    (ENVIAR_RS232, RECEBER_RS232, CONFIG_RS232)
                       6     
----                   7                     CSEG    AT      0H
0000 802E              8                     JMP             MAIN
                       9     
----                  10                     CSEG    AT      30H
0030                  11     MAIN:
0030 120000   F       12                     CALL    CONFIG_RS232    ; configura a porta de serie(flags, bourate, etc)
                      13                     ;MOV    P1,#4Fh                 ; envia 4Fh('7') para a porta de serie(P1)
                      14                     ;MOV    R4,#0                   ; inicializa o contador a 0
                      15                     ;MOV    DPTR,#MENSAGEM  ; DPTR toma o valor do apontador de MENSAGEM, ou se
                             ja o valor da primeira posição da string
0033 D293             16     LOOP:SETB       P1.3
0035 A2B3             17             MOV     C,P3.3  ; move para acumulador "c" o valor binário(0 ou 1) recbido de P3.3
0037 72B5             18                     ORL             C,P3.5  ; operação logica OR do acumulador "c" com o valor 
                             binário(0 ou 1) recbido de P3.5
0039 9292             19                     MOV             P1.2,C  ; mov para P1.2 o valor binário(0 ou 1) recbido de 
                             "c"
003B 80F6             20                     JMP     LOOP    ; salto para endereço absoluto "LOOP"
                      21                             
                      22     ;MAINLOOP:
                      23     ;        MOV            A,R4                    ; 'A' toma o valor de R4
                      24     ;               MOVC    A,@A+DPTR               ; Mover para 'A' o byte relativo á posição 
                             = A+DPTR(será sempre o valor da primeira posição da string
                      25     ;               CALL    ENVIAR_RS232    ; Envia o byte para a porta de serie 
                      26     ;               INC             R4                              ; incrementa 1 a R4 (R4 = R
                             4 +1
                      27     ;               CJNE    R4,#MSGLEN,MAINLOOP             ;compara R4 e #MSGLEN(tamanho da me
                             nsagem) e salta para MAINLOOP enquanto for diferente
                      28     ;MAINLOOP2:
                      29     ;               CALL    RECEBER_RS232   ; Recebe os bytes da porta de serie 
                      30     ;               CALL    ENVIAR_RS232    ; Envia o byte para a porta de serie
                      31     ;               JMP             MAINLOOP2               ; Salta sempre para MAINLOOPS2 (cic
                             lo infinito)
                      32     ;MENSAGEM:
                      33     ;               DB      "07"            ; A mensagem a enviar será "07"
                      34     ;MSGLEN  EQU $-MENSAGEM ; MSGLEN = $(posição de memoria de fim de mensagem) - MENSAGEM (pos
                             ição de memoria da primeira letra da mensagem)
                      35     
                      36     END             ;FIM DE PROGRAMA
A51 MACRO ASSEMBLER  GUIA4                                                                11/26/2013 21:53:25 PAGE     2

SYMBOL TABLE LISTING
------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES

CONFIG_RS232 . . .  C ADDR   -----       EXT
ENVIAR_RS232 . . .  C ADDR   -----       EXT
LOOP . . . . . . .  C ADDR   0033H   A   
MAIN . . . . . . .  C ADDR   0030H   A   
P1 . . . . . . . .  D ADDR   0090H   A   
P3 . . . . . . . .  D ADDR   00B0H   A   
RECEBER_RS232. . .  C ADDR   -----       EXT


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
