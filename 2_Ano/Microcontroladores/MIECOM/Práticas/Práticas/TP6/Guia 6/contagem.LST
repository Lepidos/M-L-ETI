A51 MACRO ASSEMBLER  CONTAGEM                                                             12/15/2013 19:28:30 PAGE     1


MACRO ASSEMBLER A51 V8.02b
OBJECT MODULE PLACED IN contagem.OBJ
ASSEMBLER INVOKED BY: C:\Keil\C51\BIN\A51.EXE contagem.a51 NOMOD51 SET(SMALL) DEBUG EP

LOC  OBJ            LINE     SOURCE

                       1     ; Filipe Rodrigues nº 68455
                       2     ; Eduardo Silva nº 70216
                       3     
                       4     ;       INICIO DE PROGRAMA
                       5                     
                       6     ;#include <89C51IC2.inc> 
                +1     7  +1 $save     
                +1   208  +1 $restore 
                     209     
                     210             NAME MAIN
                     211             EXTRN   CODE    (ENVIAR_RS232, RECEBER_RS232, CONFIG_RS232)
                     212                     
----                 213             CSEG    AT      0000H
0000 802E            214             JMP             MAIN
----                 215             CSEG    AT      002BH
002B 8068            216             JMP             ISR
                     217             
----                 218             CSEG    AT              0030H                   
0030                 219     MAIN:
0030 75C900          220                     MOV     T2MOD,#00H              ; temporizador2 de 8-bit com auto-reload
0033 75C800          221                     MOV     T2CON,#00H      
0036 D2AD            222                     SETB    ET2
0038 D2AF            223                     SETB    EA
003A 9000AD          224                     MOV     DPTR,#MENSAGEM  ; DPTR toma o valor do apontador de MENSAGEM, ou se
                             ja o valor da primeira posição da string
003D 7800            225                     MOV             R0,#00H
003F 7900            226                     MOV             R1,#00H
0041 7A00            227                     MOV             R2,#00H 
                     228                     
0043 7B00            229                     MOV     R3,#00H
0045 7C00            230                     MOV             R4,#00H
0047 7D00            231                     MOV             R5,#00H
0049 7EFA            232                     MOV             R6,#250
004B 7F0A            233                     MOV             R7,#10
                     234                     
004D EE              235                     MOV             A,R6
004E 75F064          236                     MOV             B,#100
0051 84              237                     DIV             AB
0052 FB              238                     MOV             R3,A
0053 ACF0            239                     MOV             R4,B
                     240                     
0055 75F00A          241                     MOV             B,#10
0058 A4              242                     MUL             AB
0059 FB              243                     MOV             R3,A
                     244                     
005A 75F00A          245                     MOV             B,#10
005D EC              246                     MOV             A,R4
005E 84              247                     DIV             AB
005F FC              248                     MOV             R4,A
                     249                     
0060 2B              250                     ADD             A,R3
0061 FD              251                     MOV             R5,A
                     252     
0062 74FF            253                     MOV             A,#0FFH
0064 9D              254                     SUBB    A,R5
0065 FF              255                     MOV             R7,A
                     256             
0066                 257     TIMER: 
A51 MACRO ASSEMBLER  CONTAGEM                                                             12/15/2013 19:28:30 PAGE     2

0066 116C            258                     CALL    TIMER_OFF
0068 1180            259                     CALL    TIMER_ON
006A 80FA            260                     JMP     TIMER;
                     261     
006C                 262     TIMER_OFF:
                     263                     
006C 75CC57          264                     MOV     TL2,#57H
006F 75CD9E          265                     MOV     TH2,#9EH
0072 85CCCA          266                     MOV             RCAP2L,TL2
0075 85CCCB          267                     MOV             RCAP2H,TL2
0078 D2CA            268                     SETB    TR2                     ; início da contagem TIMER
007A 30CFFD          269                     JNB     TF2,$           ; esperar pelo fim da contagem
007D C2CF            270                     CLR     TF2                     ; limpar flag
007F 22              271                     RET
                     272     
0080                 273     TIMER_ON:
0080 75CCA8          274                     MOV     TL2,#0A8H
0083 75CD61          275                     MOV     TH2,#61H
0086 85CCCA          276                     MOV             RCAP2L,TL2
0089 85CCCB          277                     MOV             RCAP2H,TL2
008C D2CA            278                     SETB    TR2                     ; início da contagem TIMER
008E 30CFFD          279                     JNB     TF2,$           ; esperar pelo fim da contagem
0091 C2CF            280                     CLR     TF2                     ; limpar flag
0093 22              281                     RET
                     282     
0094                 283     RETORNAR:
0094 32              284                     RETI
0095                 285     ISR:    
0095 C298            286                     CLR             RI
0097 B2B7            287                     CPL     P3.7
0099 09              288                     INC             R1
009A B9FAF7          289                     CJNE    R1,#250,RETORNAR
                     290                     
009D                 291     CONTAGEM:
009D E8              292                     MOV             A,R0                    ; A = R4
009E 93              293                     MOVC    A,@A+DPTR               ; A = ao conteudo da 1ª posição da mensagem
                             /String
009F F590            294                     MOV             P1,A                    ; o display toma o valor desse cont
                             eudo
                     295                             ; verifica se passou o nº 9 (ciclo "if-else")
00A1 E8              296                     MOV             A,R0                    
00A2 B40F05          297                     CJNE    A,#0Fh,INCREMENTAR                              ; salta para "DEVOL
                             VER", se A(=R0) for diferente de "Ah"(=10)
                     298                             ; proximo nº toma valor de "0"
00A5 7800            299                     MOV             R0,#0h                                          ; R0 = "0h"
00A7 7900            300                     MOV             R1,#0h                                          ; R1 = "0h"
00A9 32              301                     RETI
00AA                 302     INCREMENTAR:
00AA 08              303                     INC             R0                                                      ; s
                             omar "1" a R0
00AB 09              304                     INC             R1                                                      ; s
                             omar "1" a R1
00AC 32              305                     RETI
00AD                 306     MENSAGEM:
00AD 0CCF5446        307                     DB      0Ch,0CFh,54h,46h,87h,26h,24h,4Fh,04h,07h,05H,04H,3CH,0CH,34H,35H   
                                          
00B1 8726244F                
00B5 04070504                
00B9 3C0C3435                
                     308     
                     309     END
A51 MACRO ASSEMBLER  CONTAGEM                                                             12/15/2013 19:28:30 PAGE     3

SYMBOL TABLE LISTING
------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES

AC . . . . . . . .  B ADDR   00D0H.6 A   
ACC. . . . . . . .  D ADDR   00E0H   A   
AUXR . . . . . . .  D ADDR   008EH   A   
AUXR1. . . . . . .  D ADDR   00A2H   A   
B. . . . . . . . .  D ADDR   00F0H   A   
BDRCON . . . . . .  D ADDR   009BH   A   
BRL. . . . . . . .  D ADDR   009AH   A   
CCAP0H . . . . . .  D ADDR   00FAH   A   
CCAP0L . . . . . .  D ADDR   00EAH   A   
CCAP1H . . . . . .  D ADDR   00FBH   A   
CCAP1L . . . . . .  D ADDR   00EBH   A   
CCAP2H . . . . . .  D ADDR   00FCH   A   
CCAP2L . . . . . .  D ADDR   00ECH   A   
CCAP3H . . . . . .  D ADDR   00FDH   A   
CCAP3L . . . . . .  D ADDR   00EDH   A   
CCAP4H . . . . . .  D ADDR   00FEH   A   
CCAP4L . . . . . .  D ADDR   00EEH   A   
CCAPM0 . . . . . .  D ADDR   00DAH   A   
CCAPM1 . . . . . .  D ADDR   00DBH   A   
CCAPM2 . . . . . .  D ADDR   00DCH   A   
CCAPM3 . . . . . .  D ADDR   00DDH   A   
CCAPM4 . . . . . .  D ADDR   00DEH   A   
CCF0 . . . . . . .  D ADDR   00D8H   A   
CCF1 . . . . . . .  D ADDR   00D9H   A   
CCF2 . . . . . . .  D ADDR   00DAH   A   
CCF3 . . . . . . .  D ADDR   00DBH   A   
CCF4 . . . . . . .  D ADDR   00DCH   A   
CCON . . . . . . .  D ADDR   00D8H   A   
CF . . . . . . . .  D ADDR   00DFH   A   
CH . . . . . . . .  D ADDR   00F9H   A   
CKCON0 . . . . . .  D ADDR   008FH   A   
CKCON1 . . . . . .  D ADDR   00AFH   A   
CKRL . . . . . . .  D ADDR   0096H   A   
CKSEL. . . . . . .  D ADDR   0085H   A   
CL . . . . . . . .  D ADDR   00E9H   A   
CMOD . . . . . . .  D ADDR   00D9H   A   
CONFIG_RS232 . . .  C ADDR   -----       EXT
CONTAGEM . . . . .  C ADDR   009DH   A   
CP_RL2 . . . . . .  B ADDR   00C8H.0 A   
CR . . . . . . . .  D ADDR   00DEH   A   
CY . . . . . . . .  B ADDR   00D0H.7 A   
C_T2 . . . . . . .  B ADDR   00C8H.1 A   
DPH. . . . . . . .  D ADDR   0083H   A   
DPL. . . . . . . .  D ADDR   0082H   A   
EA . . . . . . . .  B ADDR   00A8H.7 A   
EC . . . . . . . .  B ADDR   00A8H.6 A   
ENVIAR_RS232 . . .  C ADDR   -----       EXT
ES . . . . . . . .  B ADDR   00A8H.4 A   
ET0. . . . . . . .  B ADDR   00A8H.1 A   
ET1. . . . . . . .  B ADDR   00A8H.3 A   
ET2. . . . . . . .  B ADDR   00A8H.5 A   
EX0. . . . . . . .  B ADDR   00A8H.0 A   
EX1. . . . . . . .  B ADDR   00A8H.2 A   
EXEN2. . . . . . .  B ADDR   00C8H.3 A   
EXF2 . . . . . . .  B ADDR   00C8H.6 A   
F0 . . . . . . . .  B ADDR   00D0H.5 A   
FCON . . . . . . .  D ADDR   00D1H   A   
IE0. . . . . . . .  B ADDR   0088H.1 A   
IE1. . . . . . . .  B ADDR   0088H.3 A   
IEN0 . . . . . . .  D ADDR   00A8H   A   
A51 MACRO ASSEMBLER  CONTAGEM                                                             12/15/2013 19:28:30 PAGE     4

IEN1 . . . . . . .  D ADDR   00B1H   A   
INCREMENTAR. . . .  C ADDR   00AAH   A   
INT0 . . . . . . .  B ADDR   00B0H.2 A   
INT1 . . . . . . .  B ADDR   00B0H.3 A   
IPH0 . . . . . . .  D ADDR   00B7H   A   
IPL0 . . . . . . .  D ADDR   00B8H   A   
IPL1 . . . . . . .  D ADDR   00B2H   A   
ISR. . . . . . . .  C ADDR   0095H   A   
IT0. . . . . . . .  B ADDR   0088H.0 A   
IT1. . . . . . . .  B ADDR   0088H.2 A   
KBE. . . . . . . .  D ADDR   009DH   A   
KBF. . . . . . . .  D ADDR   009EH   A   
KBLS . . . . . . .  D ADDR   009CH   A   
MAIN . . . . . . .  C ADDR   0030H   A   
MENSAGEM . . . . .  C ADDR   00ADH   A   
OSCCON . . . . . .  D ADDR   0086H   A   
OV . . . . . . . .  B ADDR   00D0H.2 A   
P. . . . . . . . .  B ADDR   00D0H.0 A   
P0 . . . . . . . .  D ADDR   0080H   A   
P1 . . . . . . . .  D ADDR   0090H   A   
P2 . . . . . . . .  D ADDR   00A0H   A   
P3 . . . . . . . .  D ADDR   00B0H   A   
PCON . . . . . . .  D ADDR   0087H   A   
PI2. . . . . . . .  D ADDR   00C0H   A   
PI2_1. . . . . . .  B ADDR   00C0H.1 A   
PI2_O. . . . . . .  B ADDR   00C0H.0 A   
PPCL . . . . . . .  B ADDR   00B8H.6 A   
PSL. . . . . . . .  B ADDR   00B8H.4 A   
PSW. . . . . . . .  D ADDR   00D0H   A   
PT0L . . . . . . .  B ADDR   00B8H.1 A   
PT1L . . . . . . .  B ADDR   00B8H.3 A   
PT2L . . . . . . .  B ADDR   00B8H.5 A   
PX0L . . . . . . .  B ADDR   00B8H.0 A   
PX1L . . . . . . .  B ADDR   00B8H.2 A   
RB8. . . . . . . .  B ADDR   0098H.2 A   
RCAP2H . . . . . .  D ADDR   00CBH   A   
RCAP2L . . . . . .  D ADDR   00CAH   A   
RCLK . . . . . . .  B ADDR   00C8H.5 A   
RD . . . . . . . .  B ADDR   00B0H.7 A   
RECEBER_RS232. . .  C ADDR   -----       EXT
REN. . . . . . . .  B ADDR   0098H.4 A   
RETORNAR . . . . .  C ADDR   0094H   A   
RI . . . . . . . .  B ADDR   0098H.0 A   
RS0. . . . . . . .  B ADDR   00D0H.3 A   
RS1. . . . . . . .  B ADDR   00D0H.4 A   
RXD. . . . . . . .  B ADDR   00B0H.0 A   
SADDR. . . . . . .  D ADDR   00A9H   A   
SADEN. . . . . . .  D ADDR   00B9H   A   
SBUF . . . . . . .  D ADDR   0099H   A   
SCON . . . . . . .  D ADDR   0098H   A   
SM0. . . . . . . .  B ADDR   0098H.7 A   
SM1. . . . . . . .  B ADDR   0098H.6 A   
SM2. . . . . . . .  B ADDR   0098H.5 A   
SP . . . . . . . .  D ADDR   0081H   A   
SPCON. . . . . . .  D ADDR   00C3H   A   
SPDAT. . . . . . .  D ADDR   00C5H   A   
SPSTA. . . . . . .  D ADDR   00C4H   A   
SSADR. . . . . . .  D ADDR   0096H   A   
SSCON. . . . . . .  D ADDR   0093H   A   
SSCS . . . . . . .  D ADDR   0094H   A   
SSDAT. . . . . . .  D ADDR   0095H   A   
T0 . . . . . . . .  B ADDR   00B0H.4 A   
T1 . . . . . . . .  B ADDR   00B0H.5 A   
T2CON. . . . . . .  D ADDR   00C8H   A   
T2MOD. . . . . . .  D ADDR   00C9H   A   
TB8. . . . . . . .  B ADDR   0098H.3 A   
A51 MACRO ASSEMBLER  CONTAGEM                                                             12/15/2013 19:28:30 PAGE     5

TCLK . . . . . . .  B ADDR   00C8H.4 A   
TCON . . . . . . .  D ADDR   0088H   A   
TF0. . . . . . . .  B ADDR   0088H.5 A   
TF1. . . . . . . .  B ADDR   0088H.7 A   
TF2. . . . . . . .  B ADDR   00C8H.7 A   
TH0. . . . . . . .  D ADDR   008CH   A   
TH1. . . . . . . .  D ADDR   008DH   A   
TH2. . . . . . . .  D ADDR   00CDH   A   
TI . . . . . . . .  B ADDR   0098H.1 A   
TIMER. . . . . . .  C ADDR   0066H   A   
TIMER_OFF. . . . .  C ADDR   006CH   A   
TIMER_ON . . . . .  C ADDR   0080H   A   
TL0. . . . . . . .  D ADDR   008AH   A   
TL1. . . . . . . .  D ADDR   008BH   A   
TL2. . . . . . . .  D ADDR   00CCH   A   
TMOD . . . . . . .  D ADDR   0089H   A   
TR0. . . . . . . .  B ADDR   0088H.4 A   
TR1. . . . . . . .  B ADDR   0088H.6 A   
TR2. . . . . . . .  B ADDR   00C8H.2 A   
TXD. . . . . . . .  B ADDR   00B0H.1 A   
WDTPRG . . . . . .  D ADDR   00A7H   A   
WDTRST . . . . . .  D ADDR   00A6H   A   
WR . . . . . . . .  B ADDR   00B0H.6 A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
